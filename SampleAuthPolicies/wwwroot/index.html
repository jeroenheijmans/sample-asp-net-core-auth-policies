<!DOCTYPE html>
<html>
<head>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            let capturedAccessToken = "not captured yet...";

            async function apiGet(route, token) {
                const headers = token ? { "Authorization": `Bearer ${token}` } : {};
                const response = await fetch(route, { headers });
                if (response.status >= 400) { return `Response status ${response.status}`; }
                const json = await response.json();
                return JSON.stringify(json, null, 2);
            }

            async function getTokenResponse() {
                const response = await fetch("/connect/token", {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8',
                    },
                    body: new URLSearchParams({
                        "grant_type": "password",
                        "client_id": "legacy-rpo",
                        "username": "john",
                        "password": "secret",
                    }),
                });

                const json = await response.json();

                if (!!json.access_token) { capturedAccessToken = json.access_token; }

                return JSON.stringify(json, null, 2);
            }

            const el = id => document.getElementById(id);

            el("btnRightly").addEventListener("click", async () => el("data").value = await getTokenResponse());

            el("unprotected").addEventListener("click", async () => el("data").value = await apiGet("foo/"));
            el("forced-error").addEventListener("click", async () => el("data").value = await apiGet("foo/error"));
            el("log-warning").addEventListener("click", async () => el("data").value = await apiGet("foo/log-warning"));
            el("log-error").addEventListener("click", async () => el("data").value = await apiGet("foo/log-error"));
            el("protected").addEventListener("click", async () => el("data").value = await apiGet("foo/protected", capturedAccessToken));
        });
    </script>
</head>
<body style="font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif">
    <h1>Test page</h1>
    <p>Page best viewed with developer console open.</p>
    <p>
        <button id="btnRightly">Get Access Token</button>
        <button id="unprotected">GET /</button>
    </p>
    <textarea id="data" style="width: 100%; height: 15em; padding: 10px; background: #fafafa; box-sizing: border-box;"></textarea>
</body>
</html>